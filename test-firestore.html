<!DOCTYPE html>
<html>
<head>
    <title>Firestore Test</title>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-auth-compat.js"></script>
</head>
<body>
    <h1>Firestore Connection Test</h1>
    <div id="output"></div>

    <script>
        // Firebase config for unschooling-464413
        const firebaseConfig = {
            apiKey: "AIzaSyBX2bZmOUosU-2PXZFQVN_WLLuee_zkFzI",
            authDomain: "unschooling-464413.firebaseapp.com",
            projectId: "unschooling-464413",
            storageBucket: "unschooling-464413.firebasestorage.app",
            messagingSenderId: "790275794964",
            appId: "1:790275794964:web:f981a7f0693cc186631f01"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const output = document.getElementById('output');

        async function testFirestore() {
            try {
                output.innerHTML = '<p>Testing Firestore connection...</p>';
                
                // Test 1: Anonymous auth
                output.innerHTML += '<p>1. Testing anonymous authentication...</p>';
                const userCredential = await auth.signInAnonymously();
                const user = userCredential.user;
                output.innerHTML += `<p>‚úÖ Anonymous auth successful. UID: ${user.uid}</p>`;
                
                // Test 2: Write to Firestore
                output.innerHTML += '<p>2. Testing Firestore write...</p>';
                const testRef = db.collection('test').doc('connection');
                await testRef.set({
                    timestamp: new Date(),
                    uid: user.uid
                });
                output.innerHTML += '<p>‚úÖ Firestore write successful</p>';
                
                // Test 3: Read from Firestore
                output.innerHTML += '<p>3. Testing Firestore read...</p>';
                const doc = await testRef.get();
                output.innerHTML += `<p>‚úÖ Firestore read successful. Data: ${JSON.stringify(doc.data())}</p>`;
                
                // Test 4: Test the actual collection path
                output.innerHTML += '<p>4. Testing users/{uid}/children collection...</p>';
                const childrenRef = db.collection(`users/${user.uid}/children`);
                const childrenSnapshot = await childrenRef.get();
                output.innerHTML += `<p>‚úÖ Children collection accessible. Found ${childrenSnapshot.size} documents</p>`;
                
                // Cleanup
                await testRef.delete();
                output.innerHTML += '<p>‚úÖ Test document cleaned up</p>';
                
                output.innerHTML += '<h2>üéâ All tests passed! Firestore is working correctly.</h2>';
                
            } catch (error) {
                output.innerHTML += `<p>‚ùå Error: ${error.code} - ${error.message}</p>`;
                output.innerHTML += `<p>Stack: ${error.stack}</p>`;
            }
        }

        testFirestore();
    </script>
</body>
</html> 